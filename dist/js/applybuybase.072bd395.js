(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["applybuybase"],{"0365":function(t,a,e){},"12b6":function(t,a,e){"use strict";e("8f9b")},"153b":function(t,a,e){"use strict";a["a"]=function(t){return new Promise((function(a,e){var s=new FileReader;s.readAsDataURL(t),s.onload=function(){a(s.result)},s.onerror=function(t){e(t)}}))}},"15c1":function(t,a,e){"use strict";e.r(a);e("7f7f"),e("4917");var s=function(){var t=this,a=t._self._c;return t.data?a("div",{staticClass:"p-p-base"},[a("div",{staticClass:"node"},[t._m(0),a("div",{staticClass:"node"},[a("div",{staticClass:"node-title mb-10"},[a("span",{staticClass:"b"},[t._v("流程描述：")]),a("span",{staticClass:"mr-15"},[t._v(t._s(t.data.summary))])]),a("div",{staticClass:"node-title mb-10"},[a("span",{staticClass:"b"},[t._v("采购单号：")]),a("span",{staticClass:"mr-15"},[t._v(t._s(t.data.formNo))])]),a("div",{staticClass:"node-title mb-10"},[a("span",{staticClass:"b"},[t._v("发 起 人：")]),a("span",{staticClass:"mr-15"},[t._v(t._s(t.data.initUserName))])]),a("div",{staticClass:"node-title mb-10"},[a("span",{staticClass:"b"},[t._v("发起时间：")]),a("span",[t._v(t._s(t.data.createTime))])]),a("div",{staticClass:"node-title mb-10"},[a("span",{staticClass:"b"},[t._v("待审批附件：")]),a("span",{staticStyle:{"margin-right":"20px"}},[a("a",{staticClass:"a",staticStyle:{color:"#008eff"},attrs:{target:"_blank",flat:"",href:t.orderUrl}},[t._v("下载采购订单")])]),a("span",[t.orderUrl.match(".(pdf|jpe?g|png|bmp)$")?a("a",{staticStyle:{color:"#008eff"},attrs:{target:"_blank",flat:"",href:t.orderUrl}},[t._v("采购订单预览")]):t._e(),t.orderUrl.match(".(pdf|jpe?g|png|bmp)$")?t._e():a("a",{staticStyle:{color:"#008eff"},attrs:{target:"_blank",flat:"",href:"http://view.officeapps.live.com/op/view.aspx?src="+t.orderUrl}},[t._v("预览")])])])]),t.data.dealStep?a("div",[a("div",{staticClass:"flex-item mt-10 mb-10"},[a("span",{staticClass:"f-20"},[t._v("审批栏")]),a("span",{staticClass:"f-10 ml-20"},[t._v("当前节点:"+t._s(t.data.dealStep.stepName))])]),a("div",{staticClass:"node"},[a("div",[a("div",{staticClass:"flex"},[a("input-box",{staticClass:"flex-item",staticStyle:{"margin-right":"20px"},attrs:{"multi-line":!0,label:"审批意见"},model:{value:t.handleStep.auditInfo,callback:function(a){t.$set(t.handleStep,"auditInfo",a)},expression:"handleStep.auditInfo"}})],1),a("div",{staticClass:"flex"},[a("upload-box",{staticStyle:{width:"50%"},attrs:{btnText:"附件上传",fileList:t.fileList,multiple:t.multiple,onchange:t.uploadFile,onremove:t.removeFile}})],1),a("div",{staticClass:"flex",staticStyle:{"margin-top":"10px"}},[a("btn",{on:{click:function(a){return t.handleStepM(1)}}},[t._v("同意")]),a("btn",{staticClass:"ml-10",on:{click:function(a){return t.handleStepM(0)}}},[t._v("不同意")]),a("btn",{staticClass:"ml-10",on:{click:function(a){return t.backStepM()}}},[t._v("退回")])],1)])])]):t._e(),t.data.historyInfos?a("div",[t._m(1),a("div",{staticClass:"flex-item scroll-y"},[a("table",{staticClass:"data-table"},[t._m(2),t._l(t.data.historyInfos,(function(e,s){return a("tr",[a("td",[t._v(t._s(e.historyId))]),a("td",[t._v(t._s(e.instanceId))]),a("td",[t._v(t._s(3==e.auditResult?"发起":"审批"))]),a("td",[t._v(t._s(e.stepName))]),a("td",[t._v(t._s(e.auditUserName))]),a("td",[t._v(t._s(t.auditResults[e.auditResult].name))]),a("td",[t._v(t._s(e.auditInfo))]),null!=e.accessories?a("td",t._l(e.accessories,(function(e,s){return a("a",{key:s,attrs:{href:e.fileUrl}},[t._v(t._s(e.fileName))])})),0):a("td",[t._v("无")])])}))],2)])]):t._e(),t.data.accessories?a("div",[t._m(3),a("div",{staticClass:"flex-item"},t._l(t.data.accessories,(function(e,s){return a("div",{key:s,staticStyle:{"margin-left":"20px","margin-top":"5px"}},[a("div",{staticClass:"flex"},[a("a",{staticStyle:{"text-decoration":"none","out-line":"none",color:"blue"},attrs:{href:e.fileUrl,target:"_blank"}},[t._v(t._s(e.fileName))])])])})),0)]):t._e()]),t.backStepLayer?a("layer",{attrs:{title:"退回节点",width:"450px"}},[a("div",{staticClass:"node"},t._l(t.backSteps,(function(e){return a("div",{staticClass:"node-item"},[a("radio-box",{attrs:{label:e.stepId},model:{value:t.handleStep.backStepId,callback:function(a){t.$set(t.handleStep,"backStepId",a)},expression:"handleStep.backStepId"}}),t._v("\n                "+t._s(e.stepName)+"\n            ")],1)})),0),a("div",{staticClass:"layer-btns"},[a("btn",{attrs:{flat:""},on:{click:function(a){return t.cancel()}}},[t._v("取消")]),a("btn",{attrs:{flat:"",color:"#008eff"},on:{click:function(a){return t.complete()}}},[t._v("提交")])],1)]):t._e()],1):t._e()},n=[function(){var t=this,a=t._self._c;return a("div",{staticClass:"flex-item mt-10 mb-10"},[a("span",{staticClass:"f-20"},[t._v("基本信息")])])},function(){var t=this,a=t._self._c;return a("div",{staticClass:"flex-item mt-10 mb-10"},[a("span",{staticClass:"f-20"},[t._v("审批历史")])])},function(){var t=this,a=t._self._c;return a("tr",[a("th",{staticStyle:{width:"60px"}},[t._v("ID")]),a("th",[t._v("实例ID")]),a("th",[t._v("节点类型")]),a("th",[t._v("节点名称")]),a("th",[t._v("审核人")]),a("th",[t._v("审核结果")]),a("th",[t._v("意见")]),a("th",[t._v("审核附件")])])},function(){var t=this,a=t._self._c;return a("div",{staticClass:"flex-item mt-10 mb-10"},[a("span",{staticClass:"f-20"},[t._v("审批附件")])])}],l=e("c1df"),c=e.n(l),o=e("153b"),r={name:"p-p-base",data:function(){return{data:null,orderUrl:"/haolifa/export/purchaseOrder/",backStepLayer:!1,auditResults:[{status:0,name:"审核不通过"},{status:1,name:"审核通过"},{status:2,name:"退回"},{status:3,name:"流程初始化"}],handleStep:{id:0,stepId:0,auditInfo:"",allotUserId:null,auditResult:1,formId:0,formType:0,backStepId:null,condition:!0,accessorys:[]},backSteps:[],fileList:[],fileName:"",multiple:!0}},activated:function(){this.getData()},created:function(){this.getData()},methods:{getData:function(){var t=this;this.$http.get("/haolifa/flowInstance/flow-history/".concat(this.$route.query.instanceId)).then((function(a){a.createTime=c()(a.createTime).format("YYYY-MM-DD HH:mm"),t.data=a,t.handleStep.id=a.instanceId,a.dealStep&&(t.handleStep.stepId=a.dealStep.stepId),t.$http.get("/haolifa/purchase-order/info/".concat(a.formId)).then((function(a){t.orderUrl=a.order.fileUrl}))})).catch((function(a){t.$toast(a.message||a.msg)}))},handleStepM:function(t){var a=this;this.handleStep.auditResult=t,this.$http.post("/haolifa/flowInstance/handleStep",this.handleStep).then((function(t){a.$toast("处理成功"),a.handleStep.backStepId=null,a.backStepLayer=!1,a.getData()})).catch((function(t){a.$toast(t.msg||t.message)}))},uploadFile:function(t,a){var e=this;this.loading=!0,this.loadingMsg="正在上传",Object(o["a"])(t.source).then((function(a){e.$http.post("/haolifa/file/uploadFileBase64",{base64Source:a,fileName:t.name}).then((function(a){e.handleStep.accessorys.push({fileName:t.name,fileUrl:a}),e.loading=!1})).catch((function(t){e.$toast(t.msg||t.message),e.loading=!1}))}))},removeFile:function(){var t=this;return new Promise((function(a,e){t.handleStep.accessorys.splice(i,1),a()}))},backStepM:function(){var t=this;this.$http.get("/haolifa/flowInstance/backSteps/".concat(this.handleStep.id)).then((function(a){a.length>0?(t.backSteps=a,t.backStepLayer=!0):t.$toast("无可退回节点")})).catch((function(a){t.$toast(a.msg||a.message)}))},complete:function(){this.handleStepM(2)},cancel:function(){this.backStepLayer=!1,this.handleStep.backStepId=null}}},d=r,p=(e("cd25"),e("2877")),u=Object(p["a"])(d,s,n,!1,null,null,null);a["default"]=u.exports},2221:function(t,a,e){},"37e6":function(t,a,e){},"3f80":function(t,a,e){"use strict";e.r(a);e("7f7f"),e("4917");var s=function(){var t=this,a=t._self._c;return t.data?a("div",{staticClass:"p-p-base"},[a("div",{staticClass:"node"},[t._m(0),a("div",{staticClass:"node"},[a("div",{staticClass:"node-title mb-10"},[a("span",{staticClass:"b"},[t._v("流程描述：")]),a("span",{staticClass:"mr-15"},[t._v(t._s(t.data.summary))])]),a("div",{staticClass:"node-title mb-10"},[a("span",{staticClass:"b"},[t._v("机加工单号：")]),a("span",{staticClass:"mr-15"},[t._v(t._s(t.data.formNo))])]),a("div",{staticClass:"node-title mb-10"},[a("span",{staticClass:"b"},[t._v("发 起 人：")]),a("span",{staticClass:"mr-15"},[t._v(t._s(t.data.initUserName))])]),a("div",{staticClass:"node-title mb-10"},[a("span",{staticClass:"b"},[t._v("发起时间：")]),a("span",[t._v(t._s(t.data.createTime))])]),a("div",{staticClass:"node-title mb-10"},[a("span",{staticClass:"b"},[t._v("待审批附件：")]),a("span",{staticStyle:{"margin-right":"20px"}},[a("a",{staticClass:"a",staticStyle:{color:"#008eff"},attrs:{target:"_blank",flat:"",href:t.orderUrl}},[t._v("下载机加工订单")])]),a("span",[t.orderUrl.match(".(pdf|jpe?g|png|bmp)$")?a("a",{staticStyle:{color:"#008eff"},attrs:{target:"_blank",flat:"",href:t.orderUrl}},[t._v("机加工订单预览")]):t._e(),t.orderUrl.match(".(pdf|jpe?g|png|bmp)$")?t._e():a("a",{staticStyle:{color:"#008eff"},attrs:{target:"_blank",flat:"",href:"http://view.officeapps.live.com/op/view.aspx?src="+t.orderUrl}},[t._v("预览")])])])]),t.data.dealStep?a("div",[a("div",{staticClass:"flex-item mt-10 mb-10"},[a("span",{staticClass:"f-20"},[t._v("审批栏")]),a("span",{staticClass:"f-10 ml-20"},[t._v("当前节点:"+t._s(t.data.dealStep.stepName))])]),a("div",{staticClass:"node"},[a("div",[a("div",{staticClass:"flex"},[a("input-box",{staticClass:"flex-item",staticStyle:{"margin-right":"20px"},attrs:{"multi-line":!0,label:"审批意见"},model:{value:t.handleStep.auditInfo,callback:function(a){t.$set(t.handleStep,"auditInfo",a)},expression:"handleStep.auditInfo"}})],1),a("div",{staticClass:"flex"},[a("upload-box",{staticStyle:{width:"50%"},attrs:{btnText:"附件上传",fileList:t.fileList,multiple:t.multiple,onchange:t.uploadFile,onremove:t.removeFile}})],1),a("div",{staticClass:"flex",staticStyle:{"margin-top":"10px"}},[a("btn",{on:{click:function(a){return t.handleStepM(1)}}},[t._v("同意")]),a("btn",{staticClass:"ml-10",on:{click:function(a){return t.handleStepM(0)}}},[t._v("不同意")]),a("btn",{staticClass:"ml-10",on:{click:function(a){return t.backStepM()}}},[t._v("退回")])],1)])])]):t._e(),t.data.historyInfos?a("div",[t._m(1),a("div",{staticClass:"flex-item scroll-y"},[a("table",{staticClass:"data-table"},[t._m(2),t._l(t.data.historyInfos,(function(e,s){return a("tr",{key:s},[a("td",[t._v(t._s(e.historyId))]),a("td",[t._v(t._s(e.instanceId))]),a("td",[t._v(t._s(3==e.auditResult?"发起":"审批"))]),a("td",[t._v(t._s(e.stepName))]),a("td",[t._v(t._s(e.auditUserName))]),a("td",[t._v(t._s(t.auditResults[e.auditResult].name))]),a("td",[t._v(t._s(e.auditInfo))]),null!=e.accessories?a("td",t._l(e.accessories,(function(e,s){return a("a",{key:s,attrs:{href:e.fileUrl}},[t._v(t._s(e.fileName))])})),0):a("td",[t._v("无")])])}))],2)])]):t._e(),t.data.accessories?a("div",[t._m(3),a("div",{staticClass:"flex-item"},t._l(t.data.accessories,(function(e,s){return a("div",{key:s,staticStyle:{"margin-left":"20px","margin-top":"5px"}},[a("div",{staticClass:"flex"},[a("a",{staticStyle:{"text-decoration":"none","out-line":"none",color:"blue"},attrs:{href:e.fileUrl,target:"_blank"}},[t._v(t._s(e.fileName))])])])})),0)]):t._e()]),t.backStepLayer?a("layer",{attrs:{title:"退回节点",width:"450px"}},[a("div",{staticClass:"node"},t._l(t.backSteps,(function(e,s){return a("div",{key:s,staticClass:"node-item"},[a("radio-box",{attrs:{label:e.stepId},model:{value:t.handleStep.backStepId,callback:function(a){t.$set(t.handleStep,"backStepId",a)},expression:"handleStep.backStepId"}}),t._v("\n                "+t._s(e.stepName)+"\n            ")],1)})),0),a("div",{staticClass:"layer-btns"},[a("btn",{attrs:{flat:""},on:{click:function(a){return t.cancel()}}},[t._v("取消")]),a("btn",{attrs:{flat:"",color:"#008eff"},on:{click:function(a){return t.complete()}}},[t._v("提交")])],1)]):t._e()],1):t._e()},n=[function(){var t=this,a=t._self._c;return a("div",{staticClass:"flex-item mt-10 mb-10"},[a("span",{staticClass:"f-20"},[t._v("基本信息")])])},function(){var t=this,a=t._self._c;return a("div",{staticClass:"flex-item mt-10 mb-10"},[a("span",{staticClass:"f-20"},[t._v("审批历史")])])},function(){var t=this,a=t._self._c;return a("tr",[a("th",{staticStyle:{width:"60px"}},[t._v("ID")]),a("th",[t._v("实例ID")]),a("th",[t._v("节点类型")]),a("th",[t._v("节点名称")]),a("th",[t._v("审核人")]),a("th",[t._v("审核结果")]),a("th",[t._v("意见")]),a("th",[t._v("审核附件")])])},function(){var t=this,a=t._self._c;return a("div",{staticClass:"flex-item mt-10 mb-10"},[a("span",{staticClass:"f-20"},[t._v("审批附件")])])}],l=e("c1df"),c=e.n(l),o=e("153b"),r={name:"p-p-base",data:function(){return{data:null,orderUrl:"/haolifa/export/entrustOrder/",backStepLayer:!1,auditResults:[{status:0,name:"审核不通过"},{status:1,name:"审核通过"},{status:2,name:"退回"},{status:3,name:"流程初始化"}],handleStep:{id:0,stepId:0,auditInfo:"",allotUserId:null,auditResult:1,formId:0,formType:0,backStepId:null,condition:!0,accessorys:[]},backSteps:[],fileList:[],fileName:"",multiple:!0}},created:function(){this.getData()},activated:function(){this.getData()},methods:{getData:function(){var t=this;this.$http.get("/haolifa/flowInstance/flow-history/".concat(this.$route.query.instanceId)).then((function(a){a.createTime=c()(a.createTime).format("YYYY-MM-DD HH:mm"),t.data=a,t.handleStep.id=a.instanceId,a.dealStep&&(t.handleStep.stepId=a.dealStep.stepId),t.$http.get("/haolifa/purchase-order/info/".concat(a.formId)).then((function(a){t.orderUrl=a.order.fileUrl}))})).catch((function(a){t.$toast(a.message||a.msg)}))},handleStepM:function(t){var a=this;this.handleStep.auditResult=t,this.$http.post("/haolifa/flowInstance/handleStep",this.handleStep).then((function(t){a.$toast("处理成功"),a.handleStep.backStepId=null,a.backStepLayer=!1,a.getData()})).catch((function(t){a.$toast(t.msg||t.message)}))},uploadFile:function(t,a){var e=this;this.loading=!0,this.loadingMsg="正在上传",Object(o["a"])(t.source).then((function(a){e.$http.post("/haolifa/file/uploadFileBase64",{base64Source:a,fileName:t.name}).then((function(a){e.handleStep.accessorys.push({fileName:t.name,fileUrl:a}),e.loading=!1})).catch((function(t){e.$toast(t.msg||t.message),e.loading=!1}))}))},removeFile:function(){var t=this;return new Promise((function(a,e){t.handleStep.accessorys.splice(i,1),a()}))},backStepM:function(){var t=this;this.$http.get("/haolifa/flowInstance/backSteps/".concat(this.handleStep.id)).then((function(a){a.length>0?(t.backSteps=a,t.backStepLayer=!0):t.$toast("无可退回节点")})).catch((function(a){t.$toast(a.msg||a.message)}))},complete:function(){this.handleStepM(2)},cancel:function(){this.backStepLayer=!1,this.handleStep.backStepId=null}}},d=r,p=(e("12b6"),e("2877")),u=Object(p["a"])(d,s,n,!1,null,null,null);a["default"]=u.exports},"8f9b":function(t,a,e){},"9a63":function(t,a,e){"use strict";e("37e6")},a029:function(t,a,e){},ab34:function(t,a,e){"use strict";e("a029")},c4cb:function(t,a,e){"use strict";e.r(a);e("7f7f");var s=function(){var t=this,a=t._self._c;return t.data?a("div",{staticClass:"p-p-base"},[a("div",{staticClass:"node"},[t._m(0),a("div",{staticClass:"node"},[a("div",{staticClass:"node-title mb-10"},[a("span",{staticClass:"b"},[t._v("流程描述：")]),a("span",{staticClass:"mr-15"},[t._v(t._s(t.data.summary))])]),a("div",{staticClass:"node-title mb-10"},[a("span",{staticClass:"b"},[t._v("供应商编号：")]),a("router-link",{staticClass:"c-4",attrs:{to:"/process/supplier/"+t.data.formId}},[a("span",{staticClass:"mr-15"},[t._v("\n                        "+t._s(t.data.formNo)+"\n                        "),a("a",{staticClass:"blue",attrs:{href:"javascript:;"}},[t._v("查看")])])])],1),a("div",{staticClass:"node-title mb-10"},[a("span",{staticClass:"b"},[t._v("发 起 人：")]),a("span",{staticClass:"mr-15"},[t._v(t._s(t.data.initUserName))])]),a("div",{staticClass:"node-title mb-10"},[a("span",{staticClass:"b"},[t._v("发起时间：")]),a("span",[t._v(t._s(t.data.createTime))])])]),t.data.dealStep?a("div",[a("div",{staticClass:"flex-item mt-10 mb-10"},[a("span",{staticClass:"f-20"},[t._v("审批栏")]),a("span",{staticClass:"f-10 ml-20"},[t._v("当前节点:"+t._s(t.data.dealStep.stepName))])]),a("div",{staticClass:"node"},[a("div",[a("div",{staticClass:"flex"},[a("input-box",{staticClass:"flex-item",staticStyle:{"margin-right":"20px"},attrs:{"multi-line":!0,label:"审批意见"},model:{value:t.handleStep.auditInfo,callback:function(a){t.$set(t.handleStep,"auditInfo",a)},expression:"handleStep.auditInfo"}})],1),a("div",{staticClass:"flex"},[a("upload-box",{staticStyle:{width:"50%"},attrs:{btnText:"附件上传",multiple:t.multiple,fileList:t.fileList,onchange:t.uploadFile,onremove:t.removeFile}})],1),a("div",{staticClass:"flex",staticStyle:{"margin-top":"10px"}},[a("btn",{on:{click:function(a){return t.handleStepM(1)}}},[t._v("同意")]),a("btn",{staticClass:"ml-10",on:{click:function(a){return t.handleStepM(0)}}},[t._v("不同意")]),a("btn",{staticClass:"ml-10",on:{click:function(a){return t.backStepM()}}},[t._v("退回")])],1)])])]):t._e(),t.data.historyInfos?a("div",[t._m(1),a("div",{staticClass:"flex-item scroll-y"},[a("table",{staticClass:"data-table"},[t._m(2),t._l(t.data.historyInfos,(function(e,s){return a("tr",[a("td",[t._v(t._s(e.historyId))]),a("td",[t._v(t._s(e.instanceId))]),a("td",[t._v(t._s(3==e.auditResult?"发起":"审批"))]),a("td",[t._v(t._s(e.stepName))]),a("td",[t._v(t._s(e.auditUserName))]),a("td",[t._v(t._s(t.auditResults[e.auditResult].name))]),a("td",[t._v(t._s(e.auditInfo))]),null!=e.accessories?a("td",t._l(e.accessories,(function(e,s){return a("a",{key:s,attrs:{href:e.fileUrl}},[t._v(t._s(e.fileName))])})),0):a("td",[t._v("无")])])}))],2)])]):t._e(),t.data.accessories?a("div",[t._m(3),a("div",{staticClass:"flex-item"},t._l(t.data.accessories,(function(e,s){return a("div",{key:s,staticStyle:{"margin-left":"20px","margin-top":"5px"}},[a("div",{staticClass:"flex"},[a("a",{staticStyle:{"text-decoration":"none","out-line":"none",color:"blue"},attrs:{href:e.fileUrl,target:"_blank"}},[t._v(t._s(e.fileName))])])])})),0)]):t._e()]),t.backStepLayer?a("layer",{attrs:{title:"退回节点",width:"450px"}},[a("div",{staticClass:"node"},t._l(t.backSteps,(function(e){return a("div",{staticClass:"node-item"},[a("radio-box",{attrs:{label:e.stepId},model:{value:t.handleStep.backStepId,callback:function(a){t.$set(t.handleStep,"backStepId",a)},expression:"handleStep.backStepId"}}),t._v("\n                "+t._s(e.stepName)+"\n            ")],1)})),0),a("div",{staticClass:"layer-btns"},[a("btn",{attrs:{flat:""},on:{click:function(a){return t.cancel()}}},[t._v("取消")]),a("btn",{attrs:{flat:"",color:"#008eff"},on:{click:function(a){return t.complete()}}},[t._v("提交")])],1)]):t._e()],1):t._e()},n=[function(){var t=this,a=t._self._c;return a("div",{staticClass:"flex-item mt-10 mb-10"},[a("span",{staticClass:"f-20"},[t._v("基本信息")])])},function(){var t=this,a=t._self._c;return a("div",{staticClass:"flex-item mt-10 mb-10"},[a("span",{staticClass:"f-20"},[t._v("审批历史")])])},function(){var t=this,a=t._self._c;return a("tr",[a("th",{staticStyle:{width:"60px"}},[t._v("ID")]),a("th",[t._v("实例ID")]),a("th",[t._v("节点类型")]),a("th",[t._v("节点名称")]),a("th",[t._v("审核人")]),a("th",[t._v("审核结果")]),a("th",[t._v("意见")]),a("th",[t._v("审核附件")])])},function(){var t=this,a=t._self._c;return a("div",{staticClass:"flex-item mt-10 mb-10"},[a("span",{staticClass:"f-20"},[t._v("审批附件")])])}],l=e("c1df"),c=e.n(l),o=e("153b"),r={name:"p-p-base",data:function(){return{data:null,orderUrl:"/haolifa/export/purchaseOrder/",backStepLayer:!1,auditResults:[{status:0,name:"审核不通过"},{status:1,name:"审核通过"},{status:2,name:"退回"},{status:3,name:"流程初始化"}],handleStep:{id:0,stepId:0,auditInfo:"",allotUserId:null,auditResult:1,formId:0,formType:0,backStepId:null,condition:!0,accessorys:[{}]},backSteps:[],fileList:[],fileName:"",multiple:!0}},activated:function(){this.getData()},created:function(){this.getData()},methods:{getData:function(){var t=this;this.$http.get("/haolifa/flowInstance/flow-history/".concat(this.$route.query.instanceId)).then((function(a){a.createTime=c()(a.createTime).format("YYYY-MM-DD HH:mm"),t.data=a,t.handleStep.id=a.instanceId,a.dealStep&&(t.handleStep.stepId=a.dealStep.stepId),t.orderUrl=t.orderUrl+a.formId})).catch((function(a){t.$toast(a.message||a.msg)}))},handleStepM:function(t){var a=this;this.handleStep.auditResult=t,this.$http.post("/haolifa/flowInstance/handleStep",this.handleStep).then((function(t){a.$toast("处理成功"),a.handleStep.backStepId=null,a.backStepLayer=!1,a.getData()})).catch((function(t){a.$toast(t.msg||t.message)}))},uploadFile:function(t,a){var e=this;this.loading=!0,this.loadingMsg="正在上传",Object(o["a"])(t.source).then((function(a){e.$http.post("/haolifa/file/uploadFileBase64",{base64Source:a,fileName:t.name}).then((function(a){e.handleStep.accessorys.push({fileName:t.name,fileUrl:a}),e.loading=!1})).catch((function(t){e.$toast(t.msg||t.message),e.loading=!1}))}))},removeFile:function(){var t=this;return new Promise((function(a,e){t.handleStep.accessorys.splice(i,1),a()}))},backStepM:function(){var t=this;this.$http.get("/haolifa/flowInstance/backSteps/".concat(this.handleStep.id)).then((function(a){a.length>0?(t.backSteps=a,t.backStepLayer=!0):t.$toast("无可退回节点")})).catch((function(a){t.$toast(a.msg||a.message)}))},complete:function(){this.handleStepM(2)},cancel:function(){this.backStepLayer=!1,this.handleStep.backStepId=null}}},d=r,p=(e("9a63"),e("2877")),u=Object(p["a"])(d,s,n,!1,null,null,null);a["default"]=u.exports},cd25:function(t,a,e){"use strict";e("0365")},d3d5:function(t,a,e){"use strict";e.r(a);e("7f7f");var s=function(){var t=this,a=t._self._c;return t.data?a("div",{staticClass:"p-p-base"},[a("div",{staticClass:"node"},[t._m(0),a("div",{staticClass:"node"},[a("div",{staticClass:"node-title mb-10"},[a("span",{staticClass:"b"},[t._v("流程描述：")]),a("span",{staticClass:"mr-15"},[t._v(t._s(t.data.summary))])]),a("div",{staticClass:"node-title mb-10"},[a("span",{staticClass:"b"},[t._v("替换料单号：")]),a("span",{staticClass:"mr-15"},[t._v(t._s(t.data.formNo))])]),a("div",{staticClass:"node-title mb-10"},[a("span",{staticClass:"b"},[t._v("发 起 人：")]),a("span",{staticClass:"mr-15"},[t._v(t._s(t.data.initUserName))])]),a("div",{staticClass:"node-title mb-10"},[a("span",{staticClass:"b"},[t._v("发起时间：")]),a("span",[t._v(t._s(t.data.createTime))])]),t.replaceInfo.length>0?a("div",[a("table",{staticClass:"data-table"},[t._m(1),t._l(t.replaceInfo,(function(e,s){return a("tr",{key:s},[a("td",[t._v(t._s(e.id))]),a("td",[t._v(t._s(e.orderNo))]),a("td",[t._v(t._s(e.materialName))]),a("td",[t._v(t._s(e.materialGraphNo))]),a("td",[t._v(t._s(e.replaceMaterialGraphNo))])])}))],2)]):t._e()]),t.data.dealStep?a("div",[a("div",{staticClass:"flex-item mt-10 mb-10"},[a("span",{staticClass:"f-20"},[t._v("审批栏")]),a("span",{staticClass:"f-10 ml-20"},[t._v("当前节点:"+t._s(t.data.dealStep.stepName))])]),a("div",{staticClass:"node"},[a("div",[a("div",{staticClass:"flex"},[a("input-box",{staticClass:"flex-item",staticStyle:{"margin-right":"20px"},attrs:{"multi-line":!0,label:"审批意见"},model:{value:t.handleStep.auditInfo,callback:function(a){t.$set(t.handleStep,"auditInfo",a)},expression:"handleStep.auditInfo"}})],1),a("div",{staticClass:"flex"},[a("upload-box",{staticStyle:{width:"50%"},attrs:{btnText:"附件上传",fileList:t.fileList,multiple:t.multiple,onchange:t.uploadFile,onremove:t.removeFile}})],1),a("div",{staticClass:"flex"},[a("btn",{on:{click:function(a){return t.handleStepM(1)}}},[t._v("同意")]),a("btn",{staticClass:"ml-10",on:{click:function(a){return t.handleStepM(0)}}},[t._v("不同意")]),a("btn",{staticClass:"ml-10",on:{click:function(a){return t.backStepM()}}},[t._v("退回")])],1)])])]):t._e(),t.data.historyInfos?a("div",[t._m(2),a("div",{staticClass:"flex-item scroll-y"},[a("table",{staticClass:"data-table"},[t._m(3),t._l(t.data.historyInfos,(function(e,s){return a("tr",{key:s},[a("td",[t._v(t._s(e.historyId))]),a("td",[t._v(t._s(e.instanceId))]),a("td",[t._v(t._s(3==e.auditResult?"发起":"审批"))]),a("td",[t._v(t._s(e.stepName))]),a("td",[t._v(t._s(e.auditUserName))]),a("td",[t._v(t._s(t.auditResults[e.auditResult].name))]),a("td",[t._v(t._s(e.auditInfo))]),null!=e.accessories?a("td",t._l(e.accessories,(function(e,s){return a("a",{key:s,attrs:{href:e.fileUrl}},[t._v(t._s(e.fileName))])})),0):t._e(),e.forms?t._e():a("td",[t._v("无")])])}))],2)])]):t._e(),t.data.accessories?a("div",[t._m(4),a("div",{staticClass:"flex-item"},t._l(t.data.accessories,(function(e,s){return a("div",{key:s,staticStyle:{"margin-left":"20px","margin-top":"5px"}},[a("div",{staticClass:"flex"},[a("a",{staticStyle:{"text-decoration":"none","out-line":"none",color:"blue"},attrs:{href:e.fileUrl,target:"_blank"}},[t._v(t._s(e.fileName))])])])})),0)]):t._e()]),t.backStepLayer?a("layer",{attrs:{title:"退回节点",width:"450px"}},[a("div",{staticClass:"node"},t._l(t.backSteps,(function(e,s){return a("div",{key:s,staticClass:"node-item"},[a("radio-box",{attrs:{label:e.stepId},model:{value:t.handleStep.backStepId,callback:function(a){t.$set(t.handleStep,"backStepId",a)},expression:"handleStep.backStepId"}}),t._v("\n                "+t._s(e.stepName)+"\n            ")],1)})),0),a("div",{staticClass:"layer-btns"},[a("btn",{attrs:{flat:""},on:{click:function(a){return t.cancel()}}},[t._v("取消")]),a("btn",{attrs:{flat:"",color:"#008eff"},on:{click:function(a){return t.complete()}}},[t._v("提交")])],1)]):t._e()],1):t._e()},n=[function(){var t=this,a=t._self._c;return a("div",{staticClass:"flex-item mt-10 mb-10"},[a("span",{staticClass:"f-20"},[t._v("基本信息")])])},function(){var t=this,a=t._self._c;return a("tr",[a("th",[t._v("实例ID")]),a("th",[t._v("生产订单号")]),a("th",[t._v("零件名称")]),a("th",[t._v("待替换图号")]),a("th",[t._v("替换图号")])])},function(){var t=this,a=t._self._c;return a("div",{staticClass:"flex-item mt-10 mb-10"},[a("span",{staticClass:"f-20"},[t._v("审批历史")])])},function(){var t=this,a=t._self._c;return a("tr",[a("th",{staticStyle:{width:"60px"}},[t._v("ID")]),a("th",[t._v("实例ID")]),a("th",[t._v("节点类型")]),a("th",[t._v("节点名称")]),a("th",[t._v("审核人")]),a("th",[t._v("审核结果")]),a("th",[t._v("意见")]),a("th",[t._v("审核附件")])])},function(){var t=this,a=t._self._c;return a("div",{staticClass:"flex-item mt-10 mb-10"},[a("span",{staticClass:"f-20"},[t._v("审批附件")])])}],l=e("c1df"),c=e.n(l),o=e("153b"),r={name:"p-p-base",data:function(){return{data:null,replaceInfo:[],backStepLayer:!1,auditResults:[{status:0,name:"审核不通过"},{status:1,name:"审核通过"},{status:2,name:"退回"},{status:3,name:"流程初始化"}],handleStep:{id:0,stepId:0,auditInfo:"",allotUserId:null,auditResult:1,formId:0,formType:0,backStepId:null,condition:!0,accessorys:[]},backSteps:[],fileList:[],fileName:"",multiple:!0}},activated:function(){this.getData()},created:function(){this.getData()},methods:{getData:function(){var t=this;this.$http.get("/haolifa/flowInstance/flow-history/".concat(this.$route.query.instanceId)).then((function(a){a.createTime=c()(a.createTime).format("YYYY-MM-DD HH:mm"),t.data=a,t.handleStep.id=a.instanceId,a.dealStep&&(t.handleStep.stepId=a.dealStep.stepId),t.$http.get("/haolifa/order-product/replace-material-detail/".concat(a.formId)).then((function(a){t.replaceInfo.push(a)}))})).catch((function(a){t.$toast(a.message||a.msg)}))},handleStepM:function(t){var a=this;this.handleStep.auditResult=t,this.$http.post("/haolifa/flowInstance/handleStep",this.handleStep).then((function(t){a.$toast("处理成功"),a.handleStep.backStepId=null,a.backStepLayer=!1,a.getData()})).catch((function(t){a.$toast(t.msg||t.message)}))},uploadFile:function(t,a){var e=this;this.loading=!0,this.loadingMsg="正在上传",Object(o["a"])(t.source).then((function(a){e.$http.post("/haolifa/file/uploadFileBase64",{base64Source:a,fileName:t.name}).then((function(a){e.handleStep.accessorys.push({fileName:t.name,fileUrl:a}),e.loading=!1})).catch((function(t){e.$toast(t.msg||t.message),e.loading=!1}))}))},removeFile:function(){var t=this;return new Promise((function(a,e){t.handleStep.accessorys.splice(i,1),a()}))},backStepM:function(){var t=this;this.$http.get("/haolifa/flowInstance/backSteps/".concat(this.handleStep.id)).then((function(a){a.length>0?(t.backSteps=a,t.backStepLayer=!0):t.$toast("无可退回节点")})).catch((function(a){t.$toast(a.msg||a.message)}))},complete:function(){this.handleStepM(2)},cancel:function(){this.backStepLayer=!1,this.handleStep.backStepId=null}}},d=r,p=(e("f2605"),e("2877")),u=Object(p["a"])(d,s,n,!1,null,null,null);a["default"]=u.exports},ea3d:function(t,a,e){"use strict";e.r(a);e("7f7f");var s=function(){var t=this,a=t._self._c;return t.data?a("div",{staticClass:"p-p-base"},[a("div",{staticClass:"node"},[a("div",{staticClass:"flex-item mt-10 mb-10"},[a("span",{staticClass:"f-20"},[t._v("基本信息")]),a("btn",{staticStyle:{left:"74%"},on:{click:function(a){return t.nuclear(t.data.formNo)}}},[t._v("核料清单查看")])],1),a("div",{staticClass:"node"},[a("div",{staticClass:"node-title mb-10"},[a("span",{staticClass:"b"},[t._v("流程描述：")]),a("span",{staticClass:"mr-15"},[t._v(t._s(t.data.summary))])]),a("div",{staticClass:"node-title mb-10"},[a("span",{staticClass:"b"},[t._v("生产订单号：")]),a("span",{staticClass:"mr-15"},[t._v(t._s(t.data.formNo))])]),a("div",{staticClass:"node-title mb-10"},[a("span",{staticClass:"b"},[t._v("发 起 人：")]),a("span",{staticClass:"mr-15"},[t._v(t._s(t.data.initUserName))])]),a("div",{staticClass:"node-title mb-10"},[a("span",{staticClass:"b"},[t._v("发起时间：")]),a("span",[t._v(t._s(t.data.createTime))])]),a("div",{staticClass:"node-title mb-10"},[a("span",{staticClass:"b"},[t._v("待审批附件：")]),a("span",[a("a",{staticClass:"a",staticStyle:{color:"#008eff"},attrs:{flat:"",href:t.orderUrl}},[t._v("下载生产订单")])])]),a("div",{staticClass:"node-title mb-10"},[a("span",{staticClass:"b"},[t._v("待审批附件预览：")]),a("span",[a("a",{staticClass:"a",staticStyle:{color:"#008eff"},attrs:{target:"_blank",flat:"",href:"http://view.officeapps.live.com/op/view.aspx?src="+t.orderUrl}},[t._v("生产订单预览")])])])]),t.data.dealStep?a("div",[a("div",{staticClass:"flex-item mt-10 mb-10"},[a("span",{staticClass:"f-20"},[t._v("审批栏")]),a("span",{staticClass:"f-10 ml-20"},[t._v("当前节点:"+t._s(t.data.dealStep.stepName))])]),a("div",{staticClass:"node"},[a("div",[51==t.dealStepId?a("div",{staticClass:"flex"},[a("table",{staticClass:"f-14 order-info"},[t._m(0),t._m(1),t._m(2),t._m(3),t._l(t.technicalRequire,(function(e,s){return a("tr",{key:s},[a("td",{attrs:{colspan:"1"}},[t._v(t._s(s+1))]),a("td",{attrs:{colspan:"1"}},[a("input-box",{attrs:{type:"text"},model:{value:e.name,callback:function(a){t.$set(e,"name",a)},expression:"val.name"}})],1),a("td",{attrs:{colspan:"1"}},[a("input-box",{attrs:{type:"text"},model:{value:e.xinhao,callback:function(a){t.$set(e,"xinhao",a)},expression:"val.xinhao"}})],1),a("td",{attrs:{colspan:"1"}},[a("input-box",{attrs:{type:"text"},model:{value:e.guige,callback:function(a){t.$set(e,"guige",a)},expression:"val.guige"}})],1),a("td",{attrs:{colspan:"1"}},[a("input-box",{attrs:{type:"text"},model:{value:e.num,callback:function(a){t.$set(e,"num",a)},expression:"val.num"}})],1),a("td",{attrs:{colspan:"1"}},[a("input-box",{attrs:{type:"text"},model:{value:e.biaozhun,callback:function(a){t.$set(e,"biaozhun",a)},expression:"val.biaozhun"}})],1),a("td",{attrs:{colspan:"1"}},[a("input-box",{attrs:{type:"text"},model:{value:e.lianjiek,callback:function(a){t.$set(e,"lianjiek",a)},expression:"val.lianjiek"}})],1),a("td",{attrs:{colspan:"1"}},[a("input-box",{attrs:{type:"text"},model:{value:e.jiaodu,callback:function(a){t.$set(e,"jiaodu",a)},expression:"val.jiaodu"}})],1),a("td",{attrs:{colspan:"1"}},[a("input-box",{attrs:{type:"text"},model:{value:e.zhongxinju,callback:function(a){t.$set(e,"zhongxinju",a)},expression:"val.zhongxinju"}})],1),a("td",{attrs:{colspan:"1"}},[a("input-box",{attrs:{type:"text"},model:{value:e.xinshi,callback:function(a){t.$set(e,"xinshi",a)},expression:"val.xinshi"}})],1),a("td",{attrs:{colspan:"1"}},[a("input-box",{attrs:{type:"text"},model:{value:e.length,callback:function(a){t.$set(e,"length",a)},expression:"val.length"}})],1),a("td",{attrs:{colspan:"1"}},[a("input-box",{attrs:{type:"text"},model:{value:e.tuhao,callback:function(a){t.$set(e,"tuhao",a)},expression:"val.tuhao"}})],1),a("td",{attrs:{colspan:"1"}},[a("input-box",{attrs:{type:"text"},model:{value:e.guodupan,callback:function(a){t.$set(e,"guodupan",a)},expression:"val.guodupan"}})],1),a("td",{attrs:{colspan:"1"}},[a("input-box",{attrs:{type:"text"},model:{value:e.jinniuju,callback:function(a){t.$set(e,"jinniuju",a)},expression:"val.jinniuju"}})],1),a("td",{attrs:{colspan:"1"}},[a("input-box",{attrs:{type:"text"},model:{value:e.jishuxinhao,callback:function(a){t.$set(e,"jishuxinhao",a)},expression:"val.jishuxinhao"}})],1),a("td",{attrs:{colspan:"1"}},[a("el-button",{attrs:{size:"mini",icon:"el-icon-circle-plus",type:"primary",circle:""},on:{click:t.addTechnicalRequire}}),t.updateInfo.technicalRequire.length>1?a("el-button",{staticStyle:{"margin-left":"0"},attrs:{size:"mini",icon:"el-icon-delete",type:"danger",circle:""},on:{click:function(a){return t.delTechnicalRequire(s)}}}):t._e()],1)])}))],2)]):t._e(),t.dealStepId>51?a("div",{staticClass:"flex"},[a("table",{staticClass:"f-14 order-info"},[t._m(4),t._m(5),t._m(6),t._m(7),t._l(t.technicalRequire,(function(e,s){return a("tr",{key:s},[a("td",{attrs:{colspan:"1"}},[t._v(t._s(s+1))]),a("td",{attrs:{colspan:"1"}},[t._v(t._s(e.name))]),a("td",{attrs:{colspan:"1"}},[t._v(t._s(e.xinhao))]),a("td",{attrs:{colspan:"1"}},[t._v(t._s(e.guige))]),a("td",{attrs:{colspan:"1"}},[t._v(t._s(e.num))]),a("td",{attrs:{colspan:"1"}},[t._v(t._s(e.biaozhun))]),a("td",{attrs:{colspan:"1"}},[t._v(t._s(e.lianjiek))]),a("td",{attrs:{colspan:"1"}},[t._v(t._s(e.jiaodu))]),a("td",{attrs:{colspan:"1"}},[t._v(t._s(e.zhongxinju))]),a("td",{attrs:{colspan:"1"}},[t._v(t._s(e.xinshi))]),a("td",{attrs:{colspan:"1"}},[t._v(t._s(e.length))]),a("td",{attrs:{colspan:"1"}},[t._v(t._s(e.tuhao))]),a("td",{attrs:{colspan:"1"}},[t._v(t._s(e.guodupan))]),a("td",{attrs:{colspan:"1"}},[t._v(t._s(e.jinniuju))]),a("td",{attrs:{colspan:"1"}},[t._v(t._s(e.jishuxinhao))])])}))],2)]):t._e(),56==t.dealStepId?a("div",{staticClass:"flex"},[a("input-box",{staticClass:"flex-item",staticStyle:{"margin-right":"20px"},attrs:{label:"装配车间"},model:{value:t.updateInfo.assemblyShop,callback:function(a){t.$set(t.updateInfo,"assemblyShop",a)},expression:"updateInfo.assemblyShop"}})],1):t._e(),57==t.dealStepId?a("div",{staticClass:"flex"},[a("input-box",{staticClass:"flex-item",staticStyle:{"margin-right":"20px"},attrs:{disabled:!0,label:"装配车间"},model:{value:t.updateInfo.assemblyShop,callback:function(a){t.$set(t.updateInfo,"assemblyShop",a)},expression:"updateInfo.assemblyShop"}}),a("input-box",{staticClass:"flex-item",staticStyle:{"margin-right":"20px"},attrs:{label:"装配小组"},model:{value:t.updateInfo.assemblyGroup,callback:function(a){t.$set(t.updateInfo,"assemblyGroup",a)},expression:"updateInfo.assemblyGroup"}})],1):t._e(),54==t.dealStepId?a("div",{staticClass:"flex"},[a("date-picker",{staticClass:"flex-item",staticStyle:{"margin-right":"20px"},attrs:{hint:"必填",label:"采购完成时间"},model:{value:t.updateInfo.purchaseFeedbackTime,callback:function(a){t.$set(t.updateInfo,"purchaseFeedbackTime",a)},expression:"updateInfo.purchaseFeedbackTime"}})],1):t._e(),55==t.dealStepId&&t.purchaseList.length>0?a("div",{staticClass:"flex"},[a("input-box",{staticClass:"flex-item",staticStyle:{"margin-right":"20px"},attrs:{disabled:!0,hint:"必填",label:"采购完成时间"},model:{value:t.updateInfo.purchaseFeedbackTime,callback:function(a){t.$set(t.updateInfo,"purchaseFeedbackTime",a)},expression:"updateInfo.purchaseFeedbackTime"}})],1):t._e(),a("div",[t.purchaseList.length>0?a("div",[t._m(8),a("div",{staticClass:"flex-item scroll-y"},[a("table",{staticClass:"data-table"},[t._m(9),t._l(t.purchaseList,(function(e,s){return a("tr",[a("td",[t._v(t._s(e.productOrderNo))]),a("td",[t._v(t._s(e.materialName))]),a("td",[t._v(t._s(e.materialGraphNo))]),a("td",[t._v(t._s(e.purchaseNumber))])])}))],2)])]):t._e()]),a("div",{staticClass:"flex"},[a("input-box",{staticClass:"flex-item",staticStyle:{"margin-right":"20px"},attrs:{"multi-line":!0,label:"审批意见"},model:{value:t.handleStep.auditInfo,callback:function(a){t.$set(t.handleStep,"auditInfo",a)},expression:"handleStep.auditInfo"}})],1),a("div",{staticClass:"flex"},[a("upload-box",{staticStyle:{width:"50%"},attrs:{btnText:"附件上传",fileList:t.fileList,onchange:t.uploadFile,onremove:t.removeFile,multiple:t.multiple}})],1),a("div",{staticClass:"flex",staticStyle:{"margin-top":"10px"}},[a("el-button",{attrs:{size:"mini",type:"primary",loading:t.loading},on:{click:function(a){return t.handleStepM(1)}}},[t._v("同意")]),a("btn",{staticClass:"ml-10",on:{click:function(a){return t.handleStepM(0)}}},[t._v("不同意")]),a("btn",{staticClass:"ml-10",on:{click:function(a){return t.backStepM()}}},[t._v("退回")])],1)])])]):t._e(),t.data.historyInfos?a("div",[t._m(10),a("div",{staticClass:"flex-item scroll-y"},[a("table",{staticClass:"data-table"},[t._m(11),t._l(t.data.historyInfos,(function(e,s){return a("tr",{key:s},[a("td",[t._v(t._s(e.historyId))]),a("td",[t._v(t._s(e.instanceId))]),a("td",[t._v(t._s(3==e.auditResult?"发起":"审批"))]),a("td",[t._v(t._s(e.stepName))]),a("td",[t._v(t._s(e.auditUserName))]),a("td",[t._v(t._s(t.auditResults[e.auditResult].name))]),a("td",[t._v(t._s(e.auditInfo))]),s<t.data.historyInfos.length-1?a("td",[t._l(e.accessories,(function(e,s){return a("a",{key:s,attrs:{target:"_blank",href:e.fileUrl}},[t._v(t._s(e.fileName))])})),a("br")],2):t.fileDetailList.length>0?a("td",[t._l(t.fileDetailList,(function(e,s){return a("a",{key:s,staticStyle:{display:"block"},attrs:{target:"_blank",href:e.fileUrl}},[t._v(t._s(e.fileName))])})),a("br")],2):a("td",[t._v("无")]),a("td",[e.accessories.length||t.fileDetailList.length?a("a",{staticClass:"blue",staticStyle:{"margin-right":"3px"},attrs:{href:"javascript:;"},on:{click:function(a){return t.removeAccessory(e.historyId)}}},[t._v("删除")]):t._e()])])}))],2)])]):t._e(),t.data.accessories?a("div",[t._m(12),a("div",{staticClass:"flex-item"},t._l(t.data.accessories,(function(e,s){return a("div",{key:s,staticStyle:{"margin-left":"20px","margin-top":"5px"}},[a("div",{staticClass:"flex"},[a("a",{staticStyle:{"text-decoration":"none","out-line":"none",color:"blue"},attrs:{href:e.fileUrl,target:"_blank"}},[t._v(t._s(e.fileName))])])])})),0)]):t._e()]),t.backStepLayer?a("layer",{attrs:{title:"退回节点",width:"450px"}},[a("div",{staticClass:"node"},t._l(t.backSteps,(function(e){return a("div",{staticClass:"node-item"},[a("radio-box",{attrs:{label:e.stepId},model:{value:t.handleStep.backStepId,callback:function(a){t.$set(t.handleStep,"backStepId",a)},expression:"handleStep.backStepId"}}),t._v("\n                "+t._s(e.stepName)+"\n            ")],1)})),0),a("div",{staticClass:"layer-btns"},[a("btn",{attrs:{flat:""},on:{click:function(a){return t.cancel()}}},[t._v("取消")]),a("btn",{attrs:{flat:"",color:"#008eff"},on:{click:function(a){return t.complete()}}},[t._v("提交")])],1)]):t._e()],1):t._e()},n=[function(){var t=this,a=t._self._c;return a("tr",[a("td",{staticStyle:{width:"2%"}}),a("td",{staticStyle:{width:"7%"}}),a("td",{staticStyle:{width:"7%"}}),a("td",{staticStyle:{width:"7%"}}),a("td",{staticStyle:{width:"7%"}}),a("td",{staticStyle:{width:"7%"}}),a("td",{staticStyle:{width:"7%"}}),a("td",{staticStyle:{width:"7%"}}),a("td",{staticStyle:{width:"7%"}}),a("td",{staticStyle:{width:"6%"}}),a("td",{staticStyle:{width:"6%"}}),a("td",{staticStyle:{width:"6%"}}),a("td",{staticStyle:{width:"6%"}}),a("td",{staticStyle:{width:"6%"}}),a("td",{staticStyle:{width:"6%"}}),a("td",{staticStyle:{width:"6%"}})])},function(){var t=this,a=t._self._c;return a("tr",[a("td",{staticClass:"b",attrs:{colspan:"16"}},[t._v("技术清单1")])])},function(){var t=this,a=t._self._c;return a("tr",[a("td",{attrs:{colspan:"1",rowspan:"2"}},[t._v("序号")]),a("td",{attrs:{colspan:"1",rowspan:"2"}},[t._v("产品名称")]),a("td",{attrs:{colspan:"1",rowspan:"2"}},[t._v("型号")]),a("td",{attrs:{colspan:"1",rowspan:"2"}},[t._v("规格")]),a("td",{attrs:{colspan:"1",rowspan:"2"}},[t._v("数量")]),a("td",{attrs:{colspan:"1",rowspan:"2"}},[t._v("上法兰标准")]),a("td",{attrs:{colspan:"3",rowspan:"1"}},[t._v("上法兰尺寸")]),a("td",{attrs:{colspan:"4",rowspan:"1"}},[t._v("出轴尺寸")]),a("td",{attrs:{colspan:"1",rowspan:"2"}},[t._v("静扭矩")]),a("td",{attrs:{colspan:"1",rowspan:"2"}},[t._v("执行器型号")]),a("td",{attrs:{colspan:"1",rowspan:"2"}},[t._v("操作")])])},function(){var t=this,a=t._self._c;return a("tr",[a("td",{attrs:{colspan:"1",rowspan:"1"}},[t._v("连接孔")]),a("td",{attrs:{colspan:"1",rowspan:"1"}},[t._v("角度")]),a("td",{attrs:{colspan:"1",rowspan:"1"}},[t._v("中心距")]),a("td",{attrs:{colspan:"1",rowspan:"1"}},[t._v("出轴型式")]),a("td",{attrs:{colspan:"1",rowspan:"1"}},[t._v("出轴长度")]),a("td",{attrs:{colspan:"1",rowspan:"1"}},[t._v("轴图号")]),a("td",{attrs:{colspan:"1",rowspan:"1"}},[t._v("过渡盘")])])},function(){var t=this,a=t._self._c;return a("tr",[a("td",{staticStyle:{width:"2%"}}),a("td",{staticStyle:{width:"7%"}}),a("td",{staticStyle:{width:"7%"}}),a("td",{staticStyle:{width:"7%"}}),a("td",{staticStyle:{width:"7%"}}),a("td",{staticStyle:{width:"7%"}}),a("td",{staticStyle:{width:"7%"}}),a("td",{staticStyle:{width:"7%"}}),a("td",{staticStyle:{width:"7%"}}),a("td",{staticStyle:{width:"7%"}}),a("td",{staticStyle:{width:"7%"}}),a("td",{staticStyle:{width:"7%"}}),a("td",{staticStyle:{width:"6%"}}),a("td",{staticStyle:{width:"6%"}})])},function(){var t=this,a=t._self._c;return a("tr",[a("td",{staticClass:"b",attrs:{colspan:"15"}},[t._v("技术清单")])])},function(){var t=this,a=t._self._c;return a("tr",[a("td",{attrs:{colspan:"1",rowspan:"2"}},[t._v("序号")]),a("td",{attrs:{colspan:"1",rowspan:"2"}},[t._v("产品名称")]),a("td",{attrs:{colspan:"1",rowspan:"2"}},[t._v("型号")]),a("td",{attrs:{colspan:"1",rowspan:"2"}},[t._v("规格")]),a("td",{attrs:{colspan:"1",rowspan:"2"}},[t._v("数量")]),a("td",{attrs:{colspan:"1",rowspan:"2"}},[t._v("上法兰标准")]),a("td",{attrs:{colspan:"3",rowspan:"1"}},[t._v("上法兰尺寸")]),a("td",{attrs:{colspan:"4",rowspan:"1"}},[t._v("出轴尺寸")]),a("td",{attrs:{colspan:"1",rowspan:"2"}},[t._v("静扭矩")]),a("td",{attrs:{colspan:"1",rowspan:"2"}},[t._v("执行器型号")])])},function(){var t=this,a=t._self._c;return a("tr",[a("td",{attrs:{colspan:"1",rowspan:"1"}},[t._v("连接孔")]),a("td",{attrs:{colspan:"1",rowspan:"1"}},[t._v("角度")]),a("td",{attrs:{colspan:"1",rowspan:"1"}},[t._v("中心距")]),a("td",{attrs:{colspan:"1",rowspan:"1"}},[t._v("出轴型式")]),a("td",{attrs:{colspan:"1",rowspan:"1"}},[t._v("出轴长度")]),a("td",{attrs:{colspan:"1",rowspan:"1"}},[t._v("轴图号")]),a("td",{attrs:{colspan:"1",rowspan:"1"}},[t._v("过渡盘")])])},function(){var t=this,a=t._self._c;return a("div",{staticClass:"flex-item mt-10 mb-10"},[a("span",{staticClass:"f-20"},[t._v("待采购项")])])},function(){var t=this,a=t._self._c;return a("tr",[a("th",[t._v("生产订单号")]),a("th",[t._v("零件名称")]),a("th",[t._v("零件图号")]),a("th",[t._v("采购数量")])])},function(){var t=this,a=t._self._c;return a("div",{staticClass:"flex-item mt-10 mb-10"},[a("span",{staticClass:"f-20"},[t._v("审批历史")])])},function(){var t=this,a=t._self._c;return a("tr",[a("th",{staticStyle:{width:"60px"}},[t._v("ID")]),a("th",[t._v("实例ID")]),a("th",[t._v("节点类型")]),a("th",[t._v("节点名称")]),a("th",[t._v("审核人")]),a("th",[t._v("审核结果")]),a("th",[t._v("意见")]),a("th",[t._v("审核附件")]),a("th",[t._v("操作")])])},function(){var t=this,a=t._self._c;return a("div",{staticClass:"flex-item mt-10 mb-10"},[a("span",{staticClass:"f-20"},[t._v("审批附件")])])}],l=e("c1df"),c=e.n(l),o=e("153b"),r={name:"p-p-base",data:function(){return{data:null,orderUrl:"/haolifa/export/purchaseOrder/",backStepLayer:!1,auditResults:[{status:0,name:"审核不通过"},{status:1,name:"审核通过"},{status:2,name:"退回"},{status:3,name:"流程初始化"}],handleStep:{id:0,stepId:0,auditInfo:"",allotUserId:null,auditResult:1,formId:0,formType:0,backStepId:null,condition:!0,accessorys:[]},backSteps:[],dealStepId:0,updateInfo:{orderNo:"",assemblyGroup:null,assemblyShop:null,finishFeedbackTime:null,purchaseFeedbackTime:null,technicalRequire:""},technicalRequire:[{name:"",xinhao:"",guige:"",num:"",biaozhun:"",lianjiek:"",jiaodu:"",zhongxinju:"",xinshi:"",length:"",tuhao:"",guodupan:"",jinniuju:"",jishuxinhao:""}],orderInfo:null,actionType:0,purchaseList:[],fileList:[],fileName:"",multiple:!0,fileDetailList:[],loading:!1}},activated:function(){this.backSteps=[],this.dealStepId=0,this.updateInfo={orderNo:"",assemblyGroup:null,assemblyShop:null,finishFeedbackTime:null,purchaseFeedbackTime:null,technicalRequire:""},this.handleStep={id:0,stepId:0,auditInfo:"",allotUserId:null,auditResult:1,formId:0,formType:0,backStepId:null,condition:!0,accessorys:[]},this.technicalRequire=[{name:"",xinhao:"",guige:"",num:"",biaozhun:"",lianjiek:"",jiaodu:"",zhongxinju:"",xinshi:"",length:"",tuhao:"",guodupan:"",jinniuju:"",jishuxinhao:""}],this.orderInfo=null,this.actionType=0,this.purchaseList=[],this.fileList=[],this.fileName="",this.multiple=!0,this.fileDetailList=[],this.loading=!1,this.getData()},created:function(){this.getData()},methods:{addTechnicalRequire:function(){this.technicalRequire.push({name:"",xinhao:"",guige:"",num:"",biaozhun:"",lianjiek:"",jiaodu:"",zhongxinju:"",xinshi:"",length:"",tuhao:"",guodupan:"",jinniuju:"",jishuxinhao:""})},delTechnicalRequire:function(t){this.technicalRequire.splice(t,1)},getData:function(){var t=this;this.$http.get("/haolifa/flowInstance/flow-history/".concat(this.$route.query.instanceId)).then((function(a){a.createTime=c()(a.createTime).format("YYYY-MM-DD HH:mm"),t.data=a,t.data.historyInfos.accessory,t.handleStep.id=a.instanceId,a.dealStep&&(t.handleStep.stepId=a.dealStep.stepId,t.dealStepId=a.dealStep.stepId),t.$http.get("/haolifa/order-product/accessory?orderNo=".concat(t.data.formNo)).then((function(a){t.fileDetailList=a})).catch((function(a){t.$toast(a.msg||a.message)})),t.$http.get("/haolifa/order-product/details?orderNo=".concat(t.data.formNo)).then((function(a){t.orderUrl=a.orderContractUrl,t.orderInfo=a,t.updateInfo.orderNo=t.data.formNo,t.technicalRequire=JSON.parse(t.orderInfo.technicalRequire),52==t.dealStepId||53==t.dealStepId?(t.updateInfo.technicalRequire=t.orderInfo.technicalRequire,t.technicalRequire=JSON.parse(t.updateInfo.technicalRequire),53==t.dealStepId&&("2"==a.orderStatus?t.actionType=1:"3"==a.orderStatus?t.actionType=2:"4"==a.orderStatus&&(t.actionType=0,t.$http.get("/haolifa/applyBuy/product/list?orderNo=".concat(t.data.formNo)).then((function(a){!(a.length>0)||(t.handleStep.condition=!1)}))))):57==t.dealStepId?t.updateInfo.assemblyShop=t.orderInfo.assemblyShop:54==t.dealStepId?t.$http.get("/haolifa/applyBuy/product/list?orderNo=".concat(t.data.formNo)).then((function(a){t.purchaseList=JSON.parse(JSON.stringify(a))})):55==t.dealStepId&&(t.$http.get("/haolifa/applyBuy/product/list?orderNo=".concat(t.data.formNo)).then((function(a){t.purchaseList=JSON.parse(JSON.stringify(a))})),t.updateInfo.purchaseFeedbackTime=c()(a.purchaseFeedbackTime).format("YYYY-MM-DD"))}))})).catch((function(a){t.$toast(a.message||a.msg)}))},handleStepM:function(t){var a=this;if(this.updateInfo.technicalRequire=JSON.stringify(this.technicalRequire),2!=t){if(1==this.actionType)return void this.$confirm({title:"核料",text:"订单未核料，是否现在核料？",color:"blue",btns:["稍后再说","现在核料"],yes:function(){a.$store.commit("DELMENUTABS","/produce"),a.$router.push("/nuclear-material?orderNo=".concat(a.orderInfo.orderNo))}});if(2==this.actionType)return void this.$confirm({title:"审批",text:"订单存在替换料审批，不能进行其它操作",color:"blue",btns:["取消","查看"],yes:function(){a.$store.commit("DELMENUTABS","/produce"),a.$router.push("/nuclear-replace-form?orderNo=".concat(a.orderInfo.orderNo))}})}1!=t||54!=this.dealStepId||null!=this.updateInfo.purchaseFeedbackTime?(this.handleStep.auditResult=t,this.$http.post("/haolifa/flowInstance/handleStep",this.handleStep).then((function(e){a.$toast("处理成功"),a.$store.commit("DELMENUTABS","/produce"),history.back(-1),a.handleStep.backStepId=null,a.backStepLayer=!1;var s=1;if(1==t){if(51==a.dealStepId?a.$http.post("/haolifa/order-product/updateInfo",a.updateInfo).then((function(t){a.updateInfo.technicalRequire=""})):52==a.dealStepId?1==a.orderInfo.isCheckMaterial&&(s=2):54==a.dealStepId?(a.$http.post("/haolifa/applyBuy/updateStatusByOrderNo?arriveTime=".concat(a.updateInfo.purchaseFeedbackTime,"&orderNo=").concat(a.updateInfo.orderNo)).then((function(t){})),a.$http.post("/haolifa/order-product/updateInfo",a.updateInfo).then((function(t){a.updateInfo.purchaseFeedbackTime=null}))):55==a.dealStepId?(1==a.orderInfo.isCheckMaterial&&(s=5),a.$http.post("/haolifa/applyBuy/updateStatusByOrderNo/2?orderNo=".concat(a.updateInfo.orderNo)).then((function(t){})),a.$http.post("/haolifa/order-product/updateInfo",a.updateInfo).then((function(t){a.updateInfo.finishFeedbackTime=null}))):56==a.dealStepId?(1==a.orderInfo.isCheckMaterial&&(s=6),a.$http.post("/haolifa/order-product/updateInfo",a.updateInfo).then((function(t){a.updateInfo.assemblyShop=null}))):57==a.dealStepId&&a.$http.post("/haolifa/order-product/updateInfo",a.updateInfo).then((function(t){a.updateInfo.assemblyGroup=null})),57!=a.dealStepId){var i={orderNo:a.data.formNo,status:s};a.$http.post("/haolifa/order-product/updateStatus",i)}}else if(2==t){53==a.handleStep.backStepId&&(s=4),56==a.handleStep.backStepId&&1==a.orderInfo.isCheckMaterial&&(s=5),a.handleStep.backStepId<53&&a.$http.post("/haolifa/order-product/release-material?orderNo=".concat(a.data.formNo));var n={orderNo:a.data.formNo,status:s};a.$http.post("/haolifa/order-product/updateStatus",n)}else{s=14;var l={orderNo:a.data.formNo,status:s};a.$http.post("/haolifa/order-product/updateStatus",l),55==a.dealStepId&&(a.$http.post("/haolifa/order-product/release-material?orderNo=".concat(l.orderNo)),a.$http.post("/haolifa/applyBuy/updateStatusByOrderNo?orderNo=".concat(a.updateInfo.orderNo,"/4")).then((function(t){}))),a.$store.commit("DELMENUTABS","/produce"),history.back(-1)}})).catch((function(t){a.$toast(t.msg||t.message)}))):this.$toast("请填写采购完成日期")},nuclear:function(t){this.$store.commit("DELMENUTABS","/produce"),this.$router.push("/nuclear-audit-form?orderNo=".concat(t))},uploadFile:function(t,a){var e=this;this.loading=!0,this.loadingMsg="正在上传",Object(o["a"])(t.source).then((function(a){e.$http.post("/haolifa/file/uploadFileBase64",{base64Source:a,fileName:t.name}).then((function(a){e.handleStep.accessorys.push({fileName:t.name,fileUrl:a}),e.loading=!1})).catch((function(t){e.$toast(t.msg||t.message),e.loading=!1}))}))},removeFile:function(){var t=this;return new Promise((function(a,e){t.handleStep.accessorys.splice(i,1),a()}))},backStepM:function(){var t=this;this.$http.get("/haolifa/flowInstance/backSteps/".concat(this.handleStep.id)).then((function(a){a.length>0?(t.backSteps=a,t.backStepLayer=!0):t.$toast("无可退回节点")})).catch((function(a){t.$toast(a.msg||a.message)}))},removeAccessory:function(t){var a=this;this.$confirm({title:"删除确认",text:"您确定要删除吗？",color:"red",btns:["取消","删除"],yes:function(){a.$http.get("/haolifa/flowInstance/remove-history-accessory/".concat(t)).then((function(t){a.$toast("删除成功"),a.getData()})).catch((function(t){a.$toast(t.msg||t.message)}))}})},complete:function(){this.handleStepM(2)},cancel:function(){this.backStepLayer=!1,this.handleStep.backStepId=null}}},d=r,p=(e("ab34"),e("2877")),u=Object(p["a"])(d,s,n,!1,null,null,null);a["default"]=u.exports},f2605:function(t,a,e){"use strict";e("2221")}}]);
//# sourceMappingURL=applybuybase.072bd395.js.map